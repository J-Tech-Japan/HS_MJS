var searchWords = $('<div class="search"><div id="MAS10032"><div class="search_breadcrumbs">財務大将について &gt; はじめに</div></div><div id="MAS10003"><div class="search_breadcrumbs">財務大将について &gt; 財務大将の概要 &gt; 財務大将について</div><div class="search_title">財務大将について</div><div class="displayText">財務大将について『LucaTech GX』の『財務大将』は、日々の仕訳入力から決算書作成までの、財務活動に関する一連の業務を行うためのシステムです。</div><div class="search_word">財務大将について『LucaTech GX』の『財務大将』は、日々の仕訳入力から決算書作成までの、財務活動に関する一連の業務を行うためのシステムです。</div></div><div id="MAS10004"><div class="search_breadcrumbs">財務大将について &gt; 財務大将の概要 &gt; 財務大将での業務の流れ</div><div class="search_title">財務大将での業務の流れ</div><div class="displayText">財務大将での業務の流れ『財務大将』の導入の流れと、日常業務から決算までの一般的な流れは次のとおりです。 『財務大将』の導入の処理フロー処理の流れ基本設定『財務大将』を使うための基本 ...</div><div class="search_word">財務大将での業務の流れ『財務大将』の導入の流れと、日常業務から決算までの一般的な流れは次のとおりです。 『財務大将』の導入の処理フロー処理の流れ基本設定『財務大将』を使うための基本的な設定を行います。⇒『財務大将の基本情報を登録する』参照登録出力順序の登録勘定科目や部門などを帳票に表示するときの並び順やレイアウトを変更します。⇒『出力順序の登録について』参照ウィンドウの設定仕訳入力画面のウィンドウ表示に関する設定を行います。⇒『ウィンドウに関する設定について』参照その他の設定伝票入力時の動作や、査印の表示、伝票・帳票の印刷に関する情報を設定します。⇒『伝票の入力・印刷情報を登録する』参照⇒『伝票や申請書入力時の査印欄情報を登録する』参照⇒『伝票や元帳の印刷情報を登録する』参照⇒『マスターエクスプローラーを自動表示する』参照残高・予算の登録勘定科目に期首残高や予算を登録します。⇒『残高登録の概要』参照  日常業務から決算までの処理フロー 処理の流れ日次仕訳の入力日々の取引を仕訳で入力します。⇒『伝票入力の画面について』参照入力した仕訳の確認入力した仕訳を仕訳帳などで確認します。⇒『仕訳を確認する』参照 月次マスター更新各種帳票に最新の計算結果を反映させるために、更新処理を行います。⇒『マスター更新を行う』参照帳票の出力財務報告書などの月次管理表を出力します。⇒『帳票表示の概要』参照月次確定その月に対して入力や修正が行えないようにデータを確定します。⇒『仕訳データを確定する』参照 年次決算整理仕訳の入力決算修正仕訳を入力します。各種帳票の出力決算業務に必要な各種帳票（総勘定元帳、消費税関係資料など）を出力します。⇒『決算書の出力について』参照⇒『消費税資料について』参照年次確定・決算更新決算業務が完了したら、データを確定し、決算更新を行います。⇒『決算を確定する』参照⇒『決算を更新する』参照翌期業務以降は、翌期の会社データで日常業務を行います。</div></div><div id="MAS10005"><div class="search_breadcrumbs">財務大将について &gt; 財務大将の概要 &gt; 会計期間と入力月について</div><div class="search_title">会計期間と入力月について</div><div class="displayText">会計期間と入力月について『LucaTech GX』の『財務大将』では、通常の仕訳入力に使用する1～12月のほかに、次の月度があります。中間決算の有無や締日により、システムに表示され ...</div><div class="search_word">会計期間と入力月について『LucaTech GX』の『財務大将』では、通常の仕訳入力に使用する1～12月のほかに、次の月度があります。中間決算の有無や締日により、システムに表示される入力月の数が異なる場合があります。  期首月（0月）期日管理に使用される月度です。受取手形や支払手形のような期日管理を行う仕訳のうち、仕訳の日付が前年度以前、到来予定の期日が当期以降となる仕訳は、決算更新時に次期データの0月に自動で保存されます。0月は、手入力で仕訳を入力することもできます。手入力する場合は、仕訳の日付に当期より前の年月日を入力します。なお、期日管理の対象でない仕訳も入力できますが、ここで入力したデータは、期日管理のみに使用され、財務報告書や決算書等の数字には反映されません。 決算月（91～93月）決算修正仕訳を入力するための月度です。3か月分あるため、決算の締めの用途に応じて、任意の運用で使い分けます。日付は末日のみ入力できます。運用例：91月減価償却費の仕訳入力後に仮締め92月賞与引当金の仕訳入力後に再度の締め93月前払費用・未収収益の仕訳入力後に再度の締め 翌期（決算日以降）翌期の仕訳を一時的に入力するための月度です。たとえば、4月～3月を会計期間とする場合、年度末の3/31の翌日となる4/1から実務上の決算業務が始まるため、すぐに当期データの確定や決算更新が行えません。この場合に、一時的に当期のデータの中に、4/1以降の日常の仕訳を入力します。 翌期の月度に入力した仕訳は、決算更新を行うと次期データにコピーされます。『財務大将』では、データの決算日以降3か月目まで仕訳を入力できます。入力したデータは、決算更新を行うと次期会社データの1～3か月目にコピーされます。 中間決算月（81～83月）半期決算の決算修正仕訳を入力するための月度です。『財務基本情報登録』の［処理区分：基本情報］＞［中間決算区分］を［半期決算］または［四半期決算］にしている場合に表示されます。使い方は、通常の決算月と同様です。 第1・第3四半期決算月（21～23月・31～33月）四半期決算の決算修正仕訳を入力するための月度です。『財務基本情報登録』の［処理区分：基本情報］＞［中間決算区分］を［四半期決算］にしている場合に表示されます。使い方は、通常の決算月と同様です。 締後（上期締後・下期締後・第1四半期締後・第3四半期締後・翌期第1四半期締後）社内の締日が暦上の末日とは異なる場合に、締後から決算に至るまでの仕訳を入力するための月度です。『会社基本情報登録』の［月次開始日］を［1日］以外にしている場合に表示されます。たとえば、［月次開始日］が20日の会社の場合、［3月］は2/21～3/20、［下期締後］は3/21～3/31となります。 入力月の一覧会計期間：令和7年4月1日～令和8年3月31日（月次開始日が1日）の場合年度月度期間仕訳入力月※1内部月※2備考前期期首月－0月0 当期4月度4/1～4/304月1 5月度5/1～5/315月2 6月度6/1～6/306月3 第1四半期締後 20月4月次開始日が1日以外の場合のみ第1四半期決算月16/30～6/3021月5四半期決算を行う場合のみ第1四半期決算月26/30～6/3022月6第1四半期決算月36/30～6/3023月77月度7/1～7/317月11 8月度8/1～8/318月12 9月度9/1～9/309月13 上期締後 80月14月次開始日が1日以外の場合のみ中間決算月19/3081月15中間決算を行う場合のみ中間決算月29/3082月16中間決算月39/3083月1710月度10/1～10/3110月21 11月度11/1～11/3011月22 12月度12/1～12/3112月23 第3四半期締後 30月24月次開始日が1日以外の場合のみ第3四半期決算月112/31～12/3131月25四半期決算を行う場合のみ第3四半期決算月212/31～12/3132月26第3四半期決算月312/31～12/3133月271月度1/1～1/311月31 2月度2/1～2/282月32 3月度3/1～3/313月33 下期締後 90月34月次開始日が1日以外の場合のみ決算月13/3191月35 決算月23/3192月36 決算月33/3193月37 翌期8年4月度3/4/1～3/4/30翌4月41 8年5月度3/5/1～3/5/31翌5月42 8年6月度3/6/1～3/6/30翌6月43 翌第1四半期締後 翌20月44月次開始日が1日以外の場合のみ第1四半期決算月16/30翌21月45四半期決算を行う場合のみ第1四半期決算月26/30翌22月46第1四半期決算月36/30翌23月47※1　「仕訳入力月」は、仕訳の入力や検索などで月度を指定するときに使用する呼び方です。※2　「内部月」は、システム内部における月度の数え方で、データ交換などで使用します。</div></div><div id="MAS10006"><div class="search_breadcrumbs">財務大将について &gt; 財務大将の概要 &gt; 勘定科目について</div><div class="search_title">勘定科目について</div><div class="displayText">勘定科目について『財務大将』には、あらかじめ標準のコードマスター（勘定科目の名称や並び順などの情報が含まれるファイル）が用意されています。コードマスターは、会社データの作成時に指定 ...</div><div class="search_word">勘定科目について『財務大将』には、あらかじめ標準のコードマスター（勘定科目の名称や並び順などの情報が含まれるファイル）が用意されています。コードマスターは、会社データの作成時に指定し、運用後は変更できません。 運用開始後に、勘定科目の追加・変更・削除をする場合は、［設定］＞［マスター登録処理］＞［科目関係］＞［科目登録］から行います。登録した科目は、『科目出力順序登録』で出力順序を登録することで、帳票に表示されるようになります。科目登録の流れについては、次を参照してください。⇒『科目を登録する』参照</div></div><div id="MAS10007"><div class="search_breadcrumbs">財務大将について &gt; 財務大将の概要 &gt; 勘定科目について &gt; 勘定科目の細目（枝番）について</div><div class="search_title">勘定科目の細目（枝番）について</div><div class="displayText">勘定科目の細目（枝番）について勘定科目に内訳を設けたい場合は、次の細目（枝番）で管理できます。 科目別補助特定の勘定科目にのみ使用する内訳は、科目別補助を使用します。たとえば、「外 ...</div><div class="search_word">勘定科目の細目（枝番）について勘定科目に内訳を設けたい場合は、次の細目（枝番）で管理できます。 科目別補助特定の勘定科目にのみ使用する内訳は、科目別補助を使用します。たとえば、「外貨預金」の内訳を「米ドル」「ユーロ」のような個別の内訳で管理したい場合は、「外貨預金」に対して「米ドル」「ユーロ」を科目別補助として登録します。科目別補助として登録した内訳は、他の勘定科目には表示されません。   共通補助（銀行、取引先、社員、汎用補助）複数の勘定科目に共通して使用する内訳は、共通補助を使用します。たとえば、「当座預金」「普通預金」などの勘定科目を、「A銀行」「B銀行」のような共通の内訳で管理したい場合は、「当座預金」「普通預金」に共通補助として銀行マスターを採用します。   部門勘定科目の内訳を部門別に管理します。賃借料や水道光熱費などのように、複数の部門で共通に負担すべき費用（共通経費）を各部門に自動で割り振る設定もできます（配賦）。 部門配賦の例   採用は、『財務基本情報登録』で行います。登録方法については、次を参照してください。⇒『科目情報を登録する』参照</div></div><div id="MAS10008"><div class="search_breadcrumbs">財務大将について &gt; 財務大将の概要 &gt; 勘定科目について &gt; 非会計科目について</div><div class="search_title">非会計科目について</div><div class="displayText">非会計科目について会計取引以外の数値を参考値として帳票に表示したり、部門配賦の割合を計算するための基準値として使用する科目として「非会計科目」があります。たとえば、製造原価報告書の ...</div><div class="search_word">非会計科目について会計取引以外の数値を参考値として帳票に表示したり、部門配賦の割合を計算するための基準値として使用する科目として「非会計科目」があります。たとえば、製造原価報告書の注記として生産数量を出力したい場合は、生産数量を「非会計科目」として登録します。登録した非会計科目を使用して仕訳を入力することで、入力した生産数量を帳票に出力することができます。  非会計科目の登録方法について非会計科目は、通常の勘定科目と同様に［設定］＞［マスター登録処理］＞［科目関係］＞［科目登録］で登録します。登録方法については、次を参照してください。⇒『非会計科目を登録する』参照 非会計科目の仕訳の入力方法について非会計科目を仕訳で入力するときは、相手科目も非会計科目を使用する必要があります。そのため、相手科目として使用するための非会計科目を別途登録しておきます。 ［人員］を仕訳入力した例 非会計科目で入力した仕訳を『仕訳参照』で確認するときは、［出力］で［非会計表示］を選択します。 なお、非会計科目で入力した仕訳は、通常は合計金額に加算されません。非会計科目も合計金額に加算するには、『印刷情報登録』で［非会計仕訳の合計金額］を［加算する］に設定します。 非会計科目の予算登録について非会計科目は、予算を登録することもできます。予算の登録については、次を参照してください。⇒『予算登録の概要』参照</div></div><div id="MAS10009"><div class="search_breadcrumbs">財務大将について &gt; 財務大将の概要 &gt; 消費税について</div><div class="search_title">消費税について</div><div class="displayText">消費税について『LucaTech GX』の『財務大将』では、仕訳に次の消費税情報を入力して申告する消費税額を求めます。  項目説明消費税コード（消費税区分）取引の内容や消費税率など ...</div><div class="search_word">消費税について『LucaTech GX』の『財務大将』では、仕訳に次の消費税情報を入力して申告する消費税額を求めます。  項目説明消費税コード（消費税区分）取引の内容や消費税率などに応じて選択する消費税の区分です。仕訳に入力した勘定科目や取引先、部門に応じて自動表示されます。⇒『消費税コードについて』参照消費税率金額に対する消費税額の割合です。仕訳に入力した勘定科目や取引先、部門に応じて自動表示されます。消費税額消費税等の金額です。内税入力または外税同時入力の場合は、金額を入力すると、消費税率に応じた消費税額が自動計算されます。事業者取引区分（仕入取引の場合）課税事業者との取引か、免税事業者等との取引かを区別する項目です。仕訳に入力した取引先に応じて自動表示されます。⇒『事業者取引区分（課税事業者／免税事業者）について』参照業種（売上取引の場合）簡易課税制度を採用して消費税額を求めるために使用される項目です。仕訳に入力した勘定科目に応じて自動表示されます。原則課税（簡易課税で申告しない）の場合も表示されます。⇒『業種について』参照内税／外税区分消費税額を内税・外税どちらの方法で入力するかの区分です。選択した消費税コードに応じて表示されます。 なお、消費税の情報が入力できるのは、『財務基本情報登録』の［処理区分：消費税情報］＞［科目別消費税］＞［科目区分］が［対象外］以外で登録されている勘定科目を仕訳に使用したときです。科目別消費税の登録については、次を参照してください。⇒『科目別消費税』参照 消費税区分と消費税率の自動表示について消費税区分と消費税率は、仕訳に入力した勘定科目や取引先などの情報から自動で表示されます。自動表示を設定する処理と、優先順位は次のとおりです。 優先順位設定説明1科目別消費税（部門別）部門別・科目別に設定された消費税情報です。［財務基本情報登録］＞［処理区分：消費税情報］＞［科目別消費税］で［対象］を［部門別］にして登録します。2取引先取引先に設定された消費税情報です。［設定］＞［マスター登録処理］＞［取引先関係］＞［取引先登録］＞［会計情報］タブの［売上消費税情報］［仕入消費税情報］で設定します。3科目別消費税（科目別補助）科目別補助（勘定科目の細目）に設定された消費税情報です。［財務基本情報登録］＞［処理区分：消費税情報］＞［科目別消費税］で登録します。4科目別消費税（科目）勘定科目に設定された消費税情報です。［財務基本情報登録］＞［処理区分：消費税情報］＞［科目別消費税］で登録します。 次の場合は、消費税区分と消費税率は自動表示されません。仕訳に入力した勘定科目の貸借で、異なる消費税コードが設定されている場合（振替伝票ミロク型のみ）仕訳に入力した勘定科目の貸借で、どちらにも消費税情報が設定されていない場合</div></div><div id="MAS10010"><div class="search_breadcrumbs">財務大将について &gt; 財務大将の概要 &gt; 消費税について &gt; 消費税額の入力方法について（内税入力・外税入力）</div><div class="search_title">消費税額の入力方法について（内税入力・外税入力）</div><div class="displayText">消費税額の入力方法について（内税入力・外税入力）消費税額は、内税または外税の形式で仕訳に入力します。内税か外税かは、入力した消費税コードにより決まります。消費税コードの一覧について ...</div><div class="search_word">消費税額の入力方法について（内税入力・外税入力）消費税額は、内税または外税の形式で仕訳に入力します。内税か外税かは、入力した消費税コードにより決まります。消費税コードの一覧については、次を参照してください。⇒『消費税コードについて』参照 『財務基本情報登録』の［処理区分：消費税情報］で［会計処理区分］を［税込］としている場合は、内税入力で仕訳を入力します。［会計処理区分］を［税抜］としている場合は、内税入力または外税入力で仕訳を入力します。  内税入力内税の消費税コードを選択した後に、消費税額を含めた金額を［金額］に入力します。消費税額は、同じ仕訳行の金額の下に自動計算されて表示されます。 内税で入力した消費税額は、自動で仮受・仮払消費税に振り替えられます。 表示された消費税額は、仕入取引の場合に修正することもできます。なお、売上取引の場合は、自動計算された消費税額は修正できません。  外税入力外税の消費税コードを選択した後に、消費税額を除いた金額を［金額］に入力します。 外税入力には、次の二つの入力方法があり、入力方法は『財務基本情報登録』の［処理区分：基本情報］＞［外税同時入力区分］で設定します。なお、［外税同時入力区分］は、期中に切り替えても問題ありません。 金額と消費税額を1行の仕訳で入力する（外税同時入力）本体価格を入力する仕訳と同じ行で、消費税額を入力します。消費税額は、同じ仕訳行の金額の下に自動計算されて表示されます。 外税同時入力で入力した消費税額は、自動で仮受・仮払消費税に振り替えられます。 表示された消費税額は、修正することもできます。また、金額を修正後に消費税額も再計算するかどうかの設定を、『財務基本情報登録』の［処理区分：基本情報］＞［外税同時金額修正時税額再計算］で設定できます。 消費税の仕訳を別に作成する（外税別々入力）仮受・仮払消費税勘定を用いて、本体金額の仕訳とは別の行で消費税の仕訳を作成します。消費税額にカーソルは止まりません。  輸入取引を外税同時入力する場合輸入取引を外税同時入力するとき、『財務基本情報登録』の［処理区分：消費税情報］＞［輸入取引区分］が［税抜処理（国税／地方税分割）］の場合は、次のように地方消費税分を別の仕訳として入力します。</div></div><div id="MAS10013"><div class="search_breadcrumbs">財務大将について &gt; 財務大将の概要 &gt; 消費税について &gt; 消費税コードについて</div><div class="search_title">消費税コードについて</div><div class="displayText">消費税コードについて仕訳の入力に使用する消費税コードの一覧です。 分類名称内税入力外税入力売上関係課税売上1020課税売上控除1222課税貸倒償却1323課税貸倒回収1525非課税 ...</div><div class="search_word">消費税コードについて仕訳の入力に使用する消費税コードの一覧です。 分類名称内税入力外税入力売上関係課税売上1020課税売上控除1222課税貸倒償却1323課税貸倒回収1525非課税売上30有価証券売上等（非課税）34不課税売上（精算取引）40不課税売上（免税期間）41輸出売上60非課税輸出売上64不明99仕入関係課税仕入1020課税仕入控除1222共通売上対応課税仕入1121非課税売上対応課税仕入1424共通売上対応課税仕入控除1525非課税売上対応課税仕入控除1626非課税仕入30不課税仕入（精算取引）40不課税仕入（免税期間）41輸入仕入7060輸入共通仕入7161非課税売上対応輸入仕入7464輸入仕入（地方消費税）－65輸入共通仕入（地方消費税）－66非課税売上対応輸入仕入（地方消費税）－69不明99棚卸消費税調整棚卸調整消費税（課税）50棚卸調整消費税（共通）51棚卸調整消費税（非課税）54特定課税仕入課税売上対応特定課税仕入80共通売上対応特定課税仕入81非課税売上対応特定課税仕入84課税売上対応特定課税仕入控除82共通売上対応特定課税仕入控除85非課税売上対応特定課税仕入控除86 消費税コード［41］について［41：不課税売上（免税期間）］［41：不課税仕入（免税期間）］は、令和5年10月1日～令和11年9月30日までの日の属する課税期間中に、免税事業者から課税事業者に変更した場合に使用する消費税コードです。 『財務基本情報登録』の［処理区分：消費税情報］＞［消費税区分］を［免税］から［原則課税］または［簡易課税］に変更し、［課税事業者になった日］に適格請求書発行事業者となった登録日を登録すると、免税事業者の期間の仕訳で［41］を入力できるようになります。 期中に免税事業者から課税事業者に変更する場合の手順については、次を参照してください。⇒『消費税情報を登録する』参照 なお、すでに入力済みの伝票の日付を変更したことで、伝票日付が［課税事業者になった日］より前の日付になった場合、その伝票の消費税コードは自動で［41］に修正されます。逆も同様です。 特定課税仕入の消費税コードについて特定課税仕入の消費税コード（80，81，84，82，85，86）は、リバースチャージ方式の取引を計上するときに使用する消費税コードです。特定課税仕入の消費税コードは、次の場合は使用できません。 売上／仕入や仕入／売上となる組み合わせの仕訳仮払消費税勘定を使用した仕訳2015年9月30日以前の日付となる仕訳消費税率3.0％、5.0％の仕訳  消費税コードの使用例取引の例と、使用する消費税コードは次のとおりです。なお、ここで使用している勘定科目は一例のため、実務上では会社の運用に応じて適切な勘定科目で仕訳を作成してください。また、ここでの標準税率は10.0％とします。 免税事業者や消費者などから行った課税仕入れの経過措置期間の仕訳については、次を参照してください。⇒『免税事業者等との取引の入力方法について（経過措置）』参照 売上高取引の内容仕訳消費税コード商品22,000円を掛取引で販売した。（内税入力）売掛金／売上22,000円10課税売上商品22,000円を掛取引で販売した。（外税入力）売掛金／複合22,000円 －複合／売上20,000円20課税売上複合／仮受消費税2,000円20課税売上商品100,000円をアメリカA社へ輸出した。売掛金／輸出売上100,000円60輸出売上非課税の商品200,000円をイギリスB社へ輸出した。売掛金／輸出売上220,000円64非課税輸出売上売り上げた商品のうち、2,200円分が返品された。（内税入力）売上返品／売掛金2,200円12課税売上控除売り上げた商品のうち、2,200円分が返品された。（外税入力）売上返品／複合2,000円22課税売上控除仮受消費税等／複合200円22課税売上控除複合／売掛金2,200円 － 売上原価取引の内容仕訳消費税コード商品11,000円を掛取引で仕入れた。（内税入力）仕入／買掛金11,000円10課税仕入商品11,000円を掛取引で仕入れた。（外税入力）仕入／複合10,000円20課税仕入仮払消費税／複合1,000円20課税仕入複合／買掛金11,000円 －前期末の商品棚卸高1,000,000円を計上。期首棚卸高／商品1,000,000円40不課税仕入当期末の商品棚卸高1,200,000円を計上。商品／期末棚卸高1,200,000円40不課税仕入商品100,000円をイギリスから輸入した。他に消費税等10,000円（国税7,800円、地方消費税2,200円）を支払った。（国税・地方消費税一括入力の場合）輸入仕入／複合100,000円60輸入仕入仮払消費税等／複合10,000円60輸入仕入複合／当座預金110,000円 －商品100,000円をイギリスから輸入した。他に消費税等10,000円（国税7,800円、地方消費税2,200円）を支払った。（国税・地方消費税分割入力の場合）輸入仕入／複合100,000円60輸入仕入仮払消費税等／複合7,800円60輸入仕入仮払消費税等／複合2,200円65輸入仕入（地方消費税）複合／当座預金110,000円 －商品100,000円をイギリスから輸入した。他に消費税等10,000円（国税7,800円、地方消費税2,200円）を支払った。（内税入力の場合）輸入仕入／当座預金110,000円70輸入仕入  販売費および一般管理費取引の内容仕訳消費税コード従業員の当月給料200,000円と定期代21,000円を支払った。給与手当／当座預金200,000円40不課税仕入（精算取引）旅費交通費／当座預金21,000円10課税仕入従業員の夜食代1,000円を○○飯店に支払った。厚生費／現金1,000円10課税仕入従業員の結婚祝金として30,000円を支払った。厚生費／現金30,000円40不課税仕入（精算取引）機械装置の減価償却費70,000円を計上した。減価償却費／減価償却累計額70,000円40不課税仕入（精算取引）○○自動車店に車検費用7,000円（重量税3,000円、自賠責1,500円、修繕費2,500円）を支払った。租税公課／複合3,000円40不課税仕入（精算取引）保険料／複合1,500円30非課税仕入修繕費／複合2,500円10課税仕入複合／当座預金7,000円 －リース契約により、当月分のリース料110,000円が引き落とされた。リース料／当座預金110,000円10課税仕入従業員の借上社宅の代金17,000円を振り込んだ。賃借料／当座預金17,000円30非課税仕入 営業外費用・収益取引の内容仕訳消費税コード○○銀行から運転資金100,000円を借り入れ、利息が500円差し引かれて振り込まれた。当座預金／複合99,500円 －支払利息／複合500円30非課税仕入複合／借入金100,000円 －普通預金に利息80円がついた。（源泉所得税等20.315％差引後）普通預金／複合80円 －租税公課／複合20円40不課税仕入（精算取引）複合／受取利息100円30非課税仕入株主配当金797円を受け取った。（源泉所得税等20.315％差引後）普通預金／複合797円 －租税公課／複合203円40不課税仕入（精算取引）複合／受取配当金1,000円40不課税仕入（精算取引）  消費税特別取引（貸倒関係）取引の内容仕訳消費税コード売掛金220,000円が貸し倒れた。（内税入力）貸倒償却／売掛金220,000円13課税貸倒償却売掛金220,000円が貸し倒れた。（外税入力）貸倒償却／複合200,000円23課税貸倒償却仮受消費税／複合20,000円23課税貸倒償却複合／売掛金220,000円 －前期に貸し倒れた売掛金が回収できた。（内税入力）現金／償却債権取立益220,000円15課税貸倒回収前期に貸し倒れた売掛金が回収できた。（外税入力）現金／複合220,000円 －複合／仮受消費税20,000円25課税貸倒回収複合／償却債権取立益200,000円25課税貸倒回収 消費税特別取引（売上調整勘定・仕入調整勘定）取引の内容仕訳消費税コード当社所有の車両（簿価9,000円）を11,000円で売却した。当座預金／複合11,000円 －複合／車両運搬具9,000円 －複合／固定資産売却益1,000円40不課税売上（精算取引）複合／仮受消費税1,000円20課税売上売上調整勘定／売上調整勘定10,000円20課税売上上場株式（簿価10,000円）を20,000円で売却した。売却手数料150円は雑損として計上する。当座預金／複合19,850円 －雑損失／複合150円14非課税売上対応課税仕入複合／有価証券10,000円 －複合／有価証券売却益10,000円40不課税売上（精算取引）売上調整勘定／売上調整勘定20,000円34有価証券売上等（非課税）当社所有の土地（簿価1,000円）を10,000円で売却した。当座預金／複合10,000円 －複合／土地1,000円 －複合／固定資産売却益9,000円40不課税売上（精算取引）売上調整勘定／売上調整勘定10,000円30非課税売上新車を20,000円で購入し、消費税を別途2,000円支払った。車両運搬具／複合20,000円 －仮払消費税／複合2,000円20課税仕入複合／当座預金22,000円 －仕入調整勘定／仕入調整勘定20,000円20課税仕入 消費税特別取引（棚卸消費税調整）取引の内容仕訳消費税コード免税事業者から課税事業者に変更したため、期首棚卸高22,000円に含まれる消費税2,000円を計上した。期首棚卸高／複合20,000円40不課税仕入仮払消費税／複合2,000円50棚卸調整消費税（課税）複合／商品22,000円 － 特定課税仕入取引の内容仕訳消費税コード国内事業者が、国外事業者にインターネット広告の配信を依頼し、100,000円を振り込んだ。広告宣伝費／普通預金100,000円80課税売上対応特定課税仕入</div></div><div id="MAS10015"><div class="search_breadcrumbs">財務大将について &gt; 財務大将の概要 &gt; 消費税について &gt; 事業者取引区分（課税事業者／免税事業者）について</div><div class="search_title">事業者取引区分（課税事業者／免税事業者）について</div><div class="displayText">事業者取引区分（課税事業者／免税事業者）について仕入取引の場合は、仕入税額控除の算出のため、事業者取引区分を仕訳に入力します。 なお、仕訳に『取引先登録』に登録されている取引先が仕 ...</div><div class="search_word">事業者取引区分（課税事業者／免税事業者）について仕入取引の場合は、仕入税額控除の算出のため、事業者取引区分を仕訳に入力します。 なお、仕訳に『取引先登録』に登録されている取引先が仕訳に入力されていない場合は、［事業者取引区分］は［課税事業者取引］になります。 事業者取引区分の判定方法事業者取引区分は、『取引先登録』に登録された情報と、［仕入日］または［伝票日付］をもとにして判定され、自動表示されます。判定に使用される日付については、次を参照してください。⇒『事業者取引区分を判定する日付について』参照  事業者取引区分を判定する日付について事業者取引区分を判定する日付は［仕入日］が使用されます。［仕入税額控除の記載事項の入力方法］が［摘要に入力する］の場合など、［仕入日］の入力がないときは［伝票日付］が使用されます。 ［仕入日］の入力形式が年月や範囲の場合は、次の日付が使用されます。日付範囲の場合、［仕入日（至）］の日付が使用されます。年月の場合、［仕入日］の月末日が使用されます。年月範囲の場合、［仕入日（至）］の月末日が使用されます。 また、仕入日と伝票日付が次の関係にある場合は、事業者取引区分を判定する日付には［伝票日付］が使用されます。伝票日付＜2023/10/1（80%控除開始日）≦仕入日伝票日付＜2026/10/1（50%控除開始日）≦仕入日伝票日付＜2029/10/1（控除なし開始日）≦仕入日 たとえば、伝票日付が「2026/9/30」、仕入日が「2026/10/1」の場合は、事業者取引区分の判定に使用される日付は「2026/9/30」となります。  仕訳に取引先が複数入力されている場合仕訳に取引先が複数入力されている場合、事業者取引区分を判定する取引先は、入力欄によって次のように優先順位が決まります。 ① ［仕入先］で選択した取引先 ② 仕入科目の補助で選択した取引先（仕入科目……科目別消費税の［科目区分］が［仕入］に設定されている勘定科目）『振替伝票（ミロク型）』で、貸借の両方に仕入科目と取引先が入力されている場合は、借方に入力された取引先が優先されます。『振替伝票』は貸借それぞれで事業者取引区分が自動セットされます。 ③ 仕入科目以外の補助（相手科目の補助）で選択した取引</div></div><div id="MAS10016"><div class="search_breadcrumbs">財務大将について &gt; 財務大将の概要 &gt; 消費税について &gt; 免税事業者等との取引の入力方法について（経過措置）</div><div class="search_title">免税事業者等との取引の入力方法について（経過措置）</div><div class="displayText">免税事業者等との取引の入力方法について（経過措置）免税事業者や消費者などから行った課税仕入れには、経過措置期間が設けられています。 経過措置期間割合2023年10月1日から2026 ...</div><div class="search_word">免税事業者等との取引の入力方法について（経過措置）免税事業者や消費者などから行った課税仕入れには、経過措置期間が設けられています。 経過措置期間割合2023年10月1日から2026年9月30日まで仕入税額相当額の80％2026年10月1日から2029年9月30日まで仕入税額相当額の50％ 経過措置期間の仕訳は、仕入税額控除が受けられない割合分（80％または50％）を該当費目に上乗せするか、期末に「雑損失」などに振り替える必要があります。運用方針に応じて、『財務基本情報登録』の［免税仕入経過措置入力方法］を次のいずれかに設定します。 ［免税仕入経過措置入力方法］入力方法控除額で仕訳入力する仕入税額控除が受けられない割合分を該当費目に上乗せして仕訳を入力します。内税の場合は、税込の金額を入力すると経過措置を考慮した消費税額が自動計算されます。外税の場合は、控除後の金額と消費税額を計算し、手入力します。後で雑損失計上する仕入税額控除が受けられない割合分を、期末に「雑損失」などに振り替える仕訳を入力します。取引時はこれまで通りに仕訳を入力します。『消費税精算表』に表示される免税事業者からの仕入金額を参考にして、雑損失に振り替える仕訳を手入力します。なお、仕入金額は、経過措置の期間に応じて「80％控除分」「50％控除分」に分けて集計されます。   経過措置期間以前の仕訳の入力例経過措置期間以前の取引は、［免税仕入経過措置入力方法］の設定に関わらず、次のように入力します。取引の内容仕訳事業者取引区分消費税コード免税事業者から消耗品を22,000円で購入した。（内税入力）消耗品費／現金22,000円課10課税仕入（内消費税2,000円）   免税事業者から消耗品を22,000円で購入した。（外税別々入力）消耗品費／複合20,000円課20課税仕入仮払消費税／複合2,000円課20課税仕入複合／現金22,000円   免税事業者から消耗品を22,000円で購入した。（外税同時入力）消耗品費／現金\20,000円課20課税仕入（消費税2,000円）     経過措置期間の仕訳は、［免税仕入経過措置入力方法］に応じて、次のように入力します。 免税仕入経過措置入力方法が［控除額で仕訳入力する］の場合仕入税額相当額の一定割合（80％または50％）を控除した消費税額で仕訳を入力します。 内税入力の場合、自動で内消費税が計算されます。外税入力の場合、消費税額が自動で計算されないため、控除されない消費税金額相当額を、該当費目に含めて入力する必要があります。 仕入税額の80％相当額を控除する場合取引の内容仕訳事業者取引区分消費税コード免税事業者から消耗品を22,000円で購入した。（内税入力）消耗品費／現金22,000円免10課税仕入（内消費税1,600円）   免税事業者から消耗品を22,000円で購入した。（外税別々入力）※消耗品費／複合20,400円免20課税仕入仮払消費税／複合1,600円免20課税仕入複合／現金22,000円   免税事業者から消耗品を22,000円で購入した。（外税同時入力）※消耗品費／現金20,400円免20課税仕入（消費税1,600円）   免税事業者から新車を22,000円で購入した。※車両運搬具／複合20,400円 20課税仕入仮払消費税／複合1,600円免20課税仕入複合／普通預金22,000円   仕入調整／仕入調整20,400円免20課税仕入※　22,000円×10÷110×80％=1,600円（消費税相当額）22,000円-1,600円=20,400円（本体金額）  仕入税額の50％相当額を控除する場合取引の内容仕訳事業者取引区分消費税コード免税事業者から消耗品を22,000円で購入した。（内税入力）消耗品費／現金22,000円免10課税仕入（内消費税1,000円）   免税事業者から消耗品を22,000円で購入した。（外税別々入力）※消耗品費／複合21,000円免20課税仕入仮払消費税／複合1,000円免20課税仕入複合／現金22,000円   免税事業者から消耗品を22,000円で購入した。（外税同時入力）※消耗品費／現金21,000円免20課税仕入（消費税1,000円）   免税事業者から新車を22,000円で購入した。※車両運搬具／複合21,000円 20課税仕入仮払消費税／複合1,000円免20課税仕入複合／普通預金22,000円   仕入調整／仕入調整21,000円免20課税仕入※　22,000円×10÷110×50％=1,000円（消費税相当額）22,000円-1,000円=21,000円（本体金額）  免税仕入経過措置入力方法が［後で雑損失計上する］の場合取引時はこれまで通りに仕訳を入力し、期末に雑損失などに振り替える仕訳を入力します。 消費税申告書の積上げ計算用の税額は内部的に計算しています。内部的に計算した消費税額や、免税事業者等からの仕入額は『消費税精算表』で確認できます。 仕入税額の80％相当額を控除する場合（取引時）取引の内容仕訳事業者取引区分消費税コード免税事業者から消耗品を22,000円で購入した。（内税入力）消耗品費／現金22,000円免10課税仕入（内消費税2,000円）   免税事業者から消耗品を22,000円で購入した。（外税別々入力）※消耗品費／複合20,000円免20課税仕入仮払消費税／複合2,000円免20課税仕入複合／現金22,000円   免税事業者から消耗品を22,000円で購入した。（外税同時入力）※消耗品費／現金20,000円免20課税仕入（消費税2,000円）   免税事業者から新車を22,000円で購入した。※車両運搬具／複合22,000円 20課税仕入仮払消費税／複合2,000円免20課税仕入複合／普通預金22,000円   仕入調整／仕入調整22,000円免20課税仕入 決算時取引の内容仕訳事業者取引区分消費税コード決算になったので、仕訳例4件分を雑損失に振り替える。雑損失／仮払消費税1,600円－40不課税仕入※　2,000円＋2,000円＋2,000円＋2,000円＝8,000円　　控除対象の元となる消費税額：8,000円×80％＝6,400円控除対象となる消費税額：8,000円－6,400円＝1,600円  仕入税額の50％相当額を控除する場合（取引時）80％相当額を控除する場合と同様です。 決算時取引の内容仕訳事業者取引区分消費税コード決算になったので、仕訳例4件分を雑損失に振り替える。雑損失／仮払消費税4,000円－40不課税仕入※　2,000円＋2,000円＋2,000円＋2,000円＝8,000円　　控除対象の元となる消費税額：8,000円×50％＝4,000円控除対象となる消費税額：8,000円－4,000円＝4,000円   経過措置期間の取引に表示される記号について経過措置の適用を受ける旨を明示するため、経過措置期間内の免税事業者等との取引には、次の記号が画面や帳票上に表示・出力されます。 出力される記号経過措置期間経過措置の割合記号2023年10月1日～2026年9月30日仕入税額相当額の80％☆2026年10月1日～2029年9月30日仕入税額相当額の50％※ 画面または印刷：摘要の先頭に記号が付加されます。 ファイル出力：［免税事業者等取引］の列に記号が出力されます。 経過措置期間の判定には、［仕入日］と［伝票日付］が使用されます。 日付の状態経過措置期間の判定［仕入日］の入力がない伝票日付が経過措置期間内であれば「☆」または「※」を出力伝票日付＜2023/10/1≦仕入日伝票日付が80％控除の経過措置期間内のため、「☆」を出力伝票日付＜2029/10/1≦仕入日伝票日付が50％控除の経過措置期間内のため、「※」を出力上記以外の場合仕入日が経過措置期間内であれば「☆」または「※」を出力</div></div><div id="MAS10018"><div class="search_breadcrumbs">財務大将について &gt; 財務大将の概要 &gt; 消費税について &gt; 業種について</div><div class="search_title">業種について</div><div class="displayText">業種について簡易課税制度を採用して消費税計算を行う場合は、売上取引の仕訳に入力した業種によって、消費税額が計算されます。   取り扱う業種が1種類の場合は、『財務基本情報登録』の［ ...</div><div class="search_word">業種について簡易課税制度を採用して消費税計算を行う場合は、売上取引の仕訳に入力した業種によって、消費税額が計算されます。   取り扱う業種が1種類の場合は、『財務基本情報登録』の［処理区分：消費税情報］で［簡易課税基準業種］を登録します。売上取引の仕訳を入力すると、すべての仕訳に［簡易課税基準業種］で登録した業種が自動セットされます。取り扱う業種が複数の場合は、『財務基本情報登録』の［処理区分：消費税情報］で［科目別業種］を登録します。売上取引の仕訳を入力すると、使用した科目に応じて紐づけた業種が自動セットされます。いずれの場合も、自動セットされた業種は変更できます。</div></div><div id="MAS10019"><div class="search_breadcrumbs">財務大将について &gt; 財務大将の概要 &gt; 消費税について &gt; 軽減税率・例外税率の表示について</div><div class="search_title">軽減税率・例外税率の表示について</div><div class="displayText">軽減税率・例外税率の表示について軽減税率（軽減8％）や例外税率（旧8％）を入力した場合は、通常の税率と区別できるように、画面や帳票上で次のとおりに表示されます。 軽減税率（軽減8％ ...</div><div class="search_word">軽減税率・例外税率の表示について軽減税率（軽減8％）や例外税率（旧8％）を入力した場合は、通常の税率と区別できるように、画面や帳票上で次のとおりに表示されます。 軽減税率（軽減8％）画面：背景色が黄色で表示されます。 印刷：消費税コードに「＃」が併記されます。 ファイル出力：［税率区分］の列に「＃」が出力されます。 軽減税率の場合に出力されるマーク「＃」は、『印刷情報登録』で別の記号にすることもできます。『伝票情報登録』の説明については、次を参照してください。⇒『印刷基本情報を登録する』参照  例外税率（旧8％）画面：文字色が赤色で表示されます。 印刷：消費税コードに「*」が併記されます。 ファイル出力：［税率区分］の列に「*」が出力されます。</div></div><div id="MAS10020"><div class="search_breadcrumbs">財務大将について &gt; 財務大将の概要 &gt; 消費税について &gt; 注記の出力について</div><div class="search_title">注記の出力について</div><div class="displayText">注記の出力について帳票の印刷時は、軽減税率対象および経過措置対象取引に表示される記号の注記も表示されます。  出力期間表示される注記～2023年9月30日注）＃印は軽減税率対象20 ...</div><div class="search_word">注記の出力について帳票の印刷時は、軽減税率対象および経過措置対象取引に表示される記号の注記も表示されます。  出力期間表示される注記～2023年9月30日注）＃印は軽減税率対象2023年10月1日～2026年9月30日注）＃印は軽減税率対象　☆印は80％控除対象2026年10月1日～2027年9月30日注）＃印は軽減税率対象　☆印は80％控除対象　※印は50％控除対象2027年10月1日～2030年9月30日注）＃印は軽減税率対象　※印は50％控除対象2030年10月1日～注）＃印は軽減税率対象 注記が表示される期間は、伝票（仕訳）日付より過去の日付が仕入日として入力される場合を想定し、実際の経過措置期間より1年多く表示期間が設けられています。 なお、軽減税率の注記は、『印刷情報登録』の［軽減税率注記出力区分］を［出力する］にしている場合に表示されます。</div></div><div id="MAS10021"><div class="search_breadcrumbs">財務大将について &gt; 財務大将の概要 &gt; 消費税について &gt; 仕入税額控除の記載事項の入力方法について</div><div class="search_title">仕入税額控除の記載事項の入力方法について</div><div class="displayText">仕入税額控除の記載事項の入力方法について仕入税額控除の適用要件を満たすために、仕入取引の仕訳には仕入税額控除の記載事項要件である「仕入日」と「仕入先」を入力する必要があります。 『 ...</div><div class="search_word">仕入税額控除の記載事項の入力方法について仕入税額控除の適用要件を満たすために、仕入取引の仕訳には仕入税額控除の記載事項要件である「仕入日」と「仕入先」を入力する必要があります。 『LucaTech GX』では、「仕入日」と「仕入先」の仕訳への入力方法は、次の2通りから選択できます。入力方法は、『財務基本情報登録』の［処理区分：基本情報］＞［仕入税額控除の記載事項の入力方法］で設定します。 摘要に入力する摘要の一部として、摘要欄に「仕入日」と「仕入先」を手入力します。  摘要欄に何も入力されていない場合は、伝票更新時に確認メッセージが表示されます。なお、摘要に内容が入力されている場合でも、その内容が「仕入日」「仕入先」であるかどうかのチェックは行われません。  仕入日／仕入先を摘要の他に入力する仕訳入力エリアに、［仕入日］［仕入先］の入力欄を設けて、別途入力します。この入力方法は、仕訳参照などで仕訳を検索するときに、［仕入日］［仕入先］を検索条件に指定できるようになります。 入力欄は、科目区分が仕入の科目を仕訳の貸借いずれかに入力し、仕入関係の消費税コードを入力した場合に表示されます。 ［仕入日］は、年月日で入力する他に、次の形式で入力することもできます。範囲の形式で入力する場合は、「自」と「至」の両方の入力が必要です。年月日範囲（YYYY/MM/DD～YYYY/MM/DD）年月（YYYY/MM）年月範囲（YYYY/MM～YYYY/MM） ［仕入先］は、取引先から選択する他に、科目別補助や固定摘要から選択したり、直接文字入力したりすることもできます。入力の操作方法については、次を参照してください。⇒『仕入日・仕入先』参照   仕入日・仕入先の入力方法を変更する場合の注意点運用開始後（仕訳の入力後）に、仕入日・仕入先の入力方法を変更する場合は、次の点に留意してください。 伝票や仕訳をコピーした場合は、コピー元の入力方法が引き継がれます。［摘要に入力する］から［仕入日／仕入先を摘要の他に入力する］に変更する場合、設定を変更する前に入力済みの仕訳には、［仕入日］［仕入先］の入力欄は表示されません。［仕入日／仕入先を摘要の他に入力する］から［摘要に入力する］に変更する運用は推奨しません。変更する場合は、［仕入日］［仕入先］が画面で確認できなくなります（CSVファイルには出力可能）。設定を変更する前に、入力済みの仕訳の［仕入日］［仕入先］を摘要欄に入力し直す必要があります。   電子帳簿を採用する場合電子帳簿を採用する場合は、［仕入税額控除の記載事項の入力方法］を一度［仕入日／仕入先を摘要の他に入力する］に変更すると、［摘要に入力する］に戻せません。</div></div><div id="MAS10024"><div class="search_breadcrumbs">財務大将について &gt; 財務大将の概要 &gt; 資金繰の管理について</div><div class="search_title">資金繰の管理について</div><div class="displayText">資金繰の管理について『LucaTech GX』の『財務大将』では、取引から資金の流れを把握するために、資金繰科目を仕訳に入力します。資金繰科目とは、流動性現預金の収入と支出を目的や ...</div><div class="search_word">資金繰の管理について『LucaTech GX』の『財務大将』では、取引から資金の流れを把握するために、資金繰科目を仕訳に入力します。資金繰科目とは、流動性現預金の収入と支出を目的や要因別に集計し、取引から資金の流れを把握するための科目です。 資金繰科目を入力できるのは、借方・貸方のいずれか一方に資金科目（流動性現預金）がある仕訳の場合です。資金科目を入力すると、相手科目に応じて、適切な資金繰科目が自動でセットされます。 仕訳入力画面の例 セットされる資金繰科目の例仕訳例資金繰科目説明現金／売上高［2:現金売上］売上による現金収入があることを意味します。広告宣伝費／現金［18:販売管理費］販売管理費による支出があることを意味します。 資金繰科目の集計結果は、資金繰管理表やキャッシュフロー計算書で確認します（現時点では未対応の帳票です）。  資金取引を複合仕訳で入力する場合資金取引を複合仕訳で入力する場合、使用する複合勘定が［複合］か［資金複合］かにより、セットされる資金繰科目が異なります。また、一つの取引の仕訳の中に［複合］と［資金複合］は併用できません。混在させると、資金繰実績が正しく計算されないことがあります。 ［複合］を使用した場合［複合］は流動性現預金科目として扱われないため、資金繰科目は［その他］が自動セットされます。正しい資金繰りを把握するためには、この仕訳の資金繰科目を適切な資金繰科目に修正する必要があります。資金繰科目は手動で修正するか、『マスター更新』時に設定に従って自動セットさせることができます。資金繰科目の自動セットについては、次を参照してください。⇒『資金情報を登録する』参照仕訳資金繰科目給与手当／複合　 \ 300,000－複合／当座預金　 \ 200,000［その他］が表示されるので、［人件費支出］に修正します。複合／預り金　　 \ 100,000－ ［資金複合］を使用した場合［資金複合］は流動性現預金科目として扱われるため、相手科目に応じて適切な資金繰科目が自動セットされます。［資金複合］を使用することで、現預金科目ではない［給与手当］［預り金］に適切な資金繰科目が自動でセットされます。 仕訳資金繰科目給与手当／資金複合　 \ 300,000［人件費支出］が表示されます。資金複合／当座預金　 \ 200,000 資金複合／預り金　　 \ 100,000［その他収入］が表示されます。</div></div><div id="MAS10025"><div class="search_breadcrumbs">財務大将について &gt; 財務大将の概要 &gt; 期日の管理について</div><div class="search_title">期日の管理について</div><div class="displayText">期日の管理について売掛金や買掛金などのように、入金や支払が発生するような科目は、仕訳で［期日］を入力して残高を管理することができます。  期日を仕訳に入力することで、期日ごとに明細 ...</div><div class="search_word">期日の管理について売掛金や買掛金などのように、入金や支払が発生するような科目は、仕訳で［期日］を入力して残高を管理することができます。  期日を仕訳に入力することで、期日ごとに明細や残高を確認できます。なお、期日が未入力の場合は、対象の科目を入力していても、管理表などの集計対象外となります。 『期日管理表』の出力例 期日の管理を行う場合は、『財務基本情報登録』の［処理区分：基本情報］＞［期日管理採用区分］を［暦月で管理］または［月度で管理］にします。 期日は、次の性格コードが設定されている科目を仕訳に入力したときに、入力できるようになります。 科目の［性格コード］入力箇所［売掛金型］［受取手形型］［期日付債権型］借方に入力したとき［支払債務型］［支払手形型］［割引手形型］［期日付債務型］貸方に入力したとき［期日付債権型2］［期日付債務型2］借方または貸方のどちらかに入力したとき 科目の性格コードについては、次を参照してください。⇒『勘定科目の登録画面について』参照 期日未定について期日が確定していない取引の場合は、仮の期日として「999999」を入力することもできます（期日未定）。  期日未定が入力された仕訳は、『期日管理表』上では次の場所に集計されます。 期日未定の入力を許可しない場合は、『財務基本情報登録』の［処理区分：基本情報］＞［期日未定］を［不可能］にします。</div></div><div id="MAS10026"><div class="search_breadcrumbs">財務大将について &gt; 財務大将の概要 &gt; 期日の管理について &gt; 期日を自動表示する</div><div class="search_title">期日を自動表示する</div><div class="displayText">期日を自動表示する期日は、自社の営業日や取引先の締日に応じて、伝票日付をもとに自動で仕訳にセットすることもできます。期日の自動表示ができるのは、科目の性格コードが［1：支払債務型］ ...</div><div class="search_word">期日を自動表示する期日は、自社の営業日や取引先の締日に応じて、伝票日付をもとに自動で仕訳にセットすることもできます。期日の自動表示ができるのは、科目の性格コードが［1：支払債務型］［5：売掛金型］に設定されている勘定科目を仕訳に入力したときです（売掛金、買掛金、未払金など）。 たとえば、「末日締・翌月末日支払」の仕入先から商品を購入した場合で、仕訳の日付が「4/30」のとき、期日には「5/31」が自動でセットされます。 期日の自動表示をする場合は、次の3つの設定を行います。 休日カレンダーの登録［設定］＞［導入処理］＞［会社情報］＞［休日登録］で、自社の休日カレンダーを登録します。 休日カレンダーの設定［休日登録］で登録した休日カレンダーを、『財務基本情報登録』の［処理区分：基本情報］＞［期日自動表示］で使用するカレンダーとして設定します。 取引先の締日の登録［設定］＞［マスター登録処理］＞［取引先関係］＞［取引先登録］で、取引先ごとに締日を登録します。締日は、［入金予定］と［支払予定］でそれぞれ3種類登録できます。</div></div><div id="MAS10027"><div class="search_breadcrumbs">財務大将について &gt; 財務大将の概要 &gt; 固定摘要について</div><div class="search_title">固定摘要について</div><div class="displayText">固定摘要について使用頻度の高い語句を「固定摘要」として登録することで、摘要を入力する手間を省くことができます。固定摘要の登録は、［設定］＞［マスター登録処理］＞［摘要関係］＞［固定 ...</div><div class="search_word">固定摘要について使用頻度の高い語句を「固定摘要」として登録することで、摘要を入力する手間を省くことができます。固定摘要の登録は、［設定］＞［マスター登録処理］＞［摘要関係］＞［固定摘要登録］で行います。登録方法については、次を参照してください。⇒『固定摘要を登録する』参照 仕訳で入力する摘要の内容を固定摘要として登録することで、次のことが可能になります。 使用頻度の高い語句を固定摘要として登録することで、摘要を入力する手間を省くことができます。 固定摘要に対して残高を登録することで、固定摘要ごとに残高の管理・集計ができます。固定摘要の残高は、『摘要残高』で登録します。登録方法は次を参照してください。⇒『摘要の残高を登録する』参照 特定の科目に対して入力必須にしたい項目がある場合は、項目を固定摘要として登録し、入力を必須にすることで入力漏れを防止できます。設定は、［設定］＞［マスター登録処理］＞［科目関係］＞［科目登録］の［仕訳入力・オプション］タブで［固定摘要］を［固定摘要必須］にします。登録方法は次を参照してください。 ⇒『実在科目・合計科目を登録する』参照</div></div><div id="MAS10028"><div class="search_breadcrumbs">財務大将について &gt; 財務大将の概要 &gt; LucaTech GX特有の仕訳について</div><div class="search_title">LucaTech GX特有の仕訳について</div><div class="displayText">LucaTech GX特有の仕訳についてここでは、『財務大将』を使用するうえで、作成方法に留意が必要な仕訳について説明します。</div><div class="search_word">LucaTech GX特有の仕訳についてここでは、『財務大将』を使用するうえで、作成方法に留意が必要な仕訳について説明します。</div></div><div id="MAS10029"><div class="search_breadcrumbs">財務大将について &gt; 財務大将の概要 &gt; LucaTech GX特有の仕訳について &gt; 複合仕訳</div><div class="search_title">複合仕訳</div><div class="displayText">複合仕訳相手科目が複数ある仕訳を入力する場合は、複合勘定を使用します。複合勘定には、次の3種類があります。一つの取引の中に、複数種類の複合勘定は混在して使用できません。 複合汎用的 ...</div><div class="search_word">複合仕訳相手科目が複数ある仕訳を入力する場合は、複合勘定を使用します。複合勘定には、次の3種類があります。一つの取引の中に、複数種類の複合勘定は混在して使用できません。 複合汎用的に使用できる複合勘定です。 資金複合資金取引の仕訳を入力するときに使用する複合勘定です。現預金科目として扱われるため、相手科目に応じた資金繰科目が仕訳にセットされます。 非会計複合非会計科目を入力するときに使用する複合勘定です。 たとえば、仕訳例①の仕訳を『振替伝票ミロク型』で入力する場合は、仕訳例②のように入力します。 仕訳例①買掛金700,000円／売掛金200,000円  ／支払手形500,000円 仕訳例②買掛金700,000円／複合700,000円複合200,000円／売掛金200,000円複合500,000円／支払手形500,000円※取引の中に流動性現預金科目がないため、「複合」を使用して1行ずつ仕訳を入力します。 また、仕訳例③のように、取引の中に流動性現預金科目がある場合は「資金複合」を使用して仕訳例④のように入力します。 仕訳例③給与手当300,000円／当座預金200,000円  ／預り金100,000円 仕訳例④給与手当300,000円／資金複合300,000円資金複合200,000円／当座預金200,000円資金複合100,000円／預り金100,000円  入力した複合仕訳の貸借金額が一致していない場合は、その差額が画面に表示されるので、必ず差額が「0」になるように修正します。 貸借の差額があるままだと、貸借対照表と損益計算書の「繰越利益剰余金」の不一致の原因となります。 なお、複合勘定を仕訳に入力するときの操作方法は、伝票の種類により異なります。複合勘定の入力方法については、次を参照してください。⇒『借方科目』参照</div></div><div id="MAS10030"><div class="search_breadcrumbs">財務大将について &gt; 財務大将の概要 &gt; LucaTech GX特有の仕訳について &gt; 棚卸仕訳</div><div class="search_title">棚卸仕訳</div><div class="displayText">棚卸仕訳棚卸仕訳は、月ごと、もしくは年1回・隔月で入力します。『財務大将』では、棚卸仕訳の入力は、前月の「期末棚卸高」を当月の「期首棚卸高」で相殺するかたちで入力します。 月次の棚 ...</div><div class="search_word">棚卸仕訳棚卸仕訳は、月ごと、もしくは年1回・隔月で入力します。『財務大将』では、棚卸仕訳の入力は、前月の「期末棚卸高」を当月の「期首棚卸高」で相殺するかたちで入力します。 月次の棚卸を行う場合の仕訳例4月月初の棚卸高：\ 1,000,000、4月末棚卸高：\ 1,500,000、5月末棚卸高：\ 2,000,0004/30期首棚卸高／商品\ 1,000,000   商品／期末棚卸高\ 1,500,000 再振替仕訳5/31期首棚卸高／商品\ 1,500,000← 商品／期末棚卸高\ 2,000,000  同一月内で「期末棚卸高」「期首棚卸高」を修正する場合は、逆仕訳で修正せずに、直接入力した仕訳を修正するか、差額分の仕訳を追加入力します。（例）4月の期末棚卸高を1,500,000円で入力したが、実際は1,000,000円だった。直接修正する場合4/30期首棚卸高／商品\ 1,000,000   商品／期末棚卸高\ 1,500,000←この仕訳を直接修正して5/31期首棚卸高／商品\ 1,500,000←1,000,000円にします。 商品／期末棚卸高\ 2,000,000   差額分の仕訳を追加入力する場合（減額する場合は金額をマイナスで入力）4/30期首棚卸高／商品\ 1,000,000   商品／期末棚卸高\ 1,500,000   商品 期末棚卸高\ －500,000←追加した仕訳5/31期首棚卸高／商品\ 1,500,000   期首棚卸高／商品\ －500,000←追加した仕訳 商品／期末棚卸高\ 2,000,000   部門を採用している場合は、部門ごとに各部門で同じ月に棚卸仕訳を入力します。たとえば、A部門は3か月ごと、B部門は毎月棚卸のように、部門ごとに棚卸時期が異なる運用の場合は、棚卸仕訳が発生しない部門は前回の棚卸金額と同じ金額で棚卸仕訳を入力し、すべての部門に毎月棚卸仕訳を入力します。</div></div><div id="MAS10031"><div class="search_breadcrumbs">財務大将について &gt; 財務大将の概要 &gt; LucaTech GX特有の仕訳について &gt; 売上調整勘定・仕入調整勘定の仕訳</div><div class="search_title">売上調整勘定・仕入調整勘定の仕訳</div><div class="displayText">売上調整勘定・仕入調整勘定の仕訳「売上調整勘定」「仕入調整勘定」は、消費税を入力しない仕訳において本体価格を入力するための勘定科目です。 「売上調整勘定」は、固定資産の売却の仕訳に ...</div><div class="search_word">売上調整勘定・仕入調整勘定の仕訳「売上調整勘定」「仕入調整勘定」は、消費税を入力しない仕訳において本体価格を入力するための勘定科目です。 「売上調整勘定」は、固定資産の売却の仕訳において、消費税の課税標準のもととなる本体価格を入力するための勘定科目です。「仕入調整勘定」は、固定資産の購入の仕訳において、仕入税額控除の対象となる課税仕入額を入力するための勘定科目です。 「売上調整勘定」「仕入調整勘定」を入力するときは、外税の消費税コードを使用します。車両を売却したときの仕訳例（会計処理区分が税抜の場合）借方貸方消費税コード金額備考現金複合－770,000 複合車両運搬具－500,000 複合固定資産売却益40：不課税200,000 複合仮受消費税20：外税70,000 売上消費税調整勘定売上消費税調整勘定20：外税700,000車両の本体価格 「売上調整勘定」「仕入調整勘定」は、仕訳で入力すると相手科目にも同じ科目が自動でセットされます。 その他の仕訳例は、次を参照してください。⇒『消費税特別取引（売上調整勘定・仕入調整勘定）』参照</div></div></div>');
// ========================================
// グローバル変数定義
// ========================================

// MutationObserver機能用のグローバル変数
var currentSearchValue = ""; // 現在の検索キーワード
var mutationObserver = null; // MutationObserverインスタンス
var debounceTimer = null; // DOM変更用のデバウンスタイマー

// jQueryセレクタキャッシュ
var $cachedElements = {
    iframe: null,
    searchField: null,
    searchResultItemsBlock: null,
    searchResultsEnd: null,
    searchMsg: null,
    searchInput: null
};

// セレクタマップ（キャッシュ機構の効率化）
var selectorMap = {
    iframe: "iframe.topic",
    searchField: ".wSearchField",
    searchResultItemsBlock: ".wSearchResultItemsBlock",
    searchResultsEnd: ".wSearchResultsEnd",
    searchMsg: "#searchMsg",
    searchInput: ".search-input"
};

// HTMLエンティティ復元用の正規表現（効率化のためグローバル定義）
var htmlEntityRegexes = {
    nbsp: /&nbsp;(?=[^<>]*<)/gm,
    gt: /&gt;(?=[^<>]*<)/gm,
    lt: /&lt;(?=[^<>]*<)/gm,
    quot: /&quot;(?=[^<>]*<)/gm,
    amp: /&amp;(?=[^<>]*<)/gm
};

// 文字変換マップ（効率化のため初期化時に正規表現を構築）
var characterMappings = (function () {
    // 文字変換用の配列定義（配列リテラルに変更）
    var wide = ["０", "１", "２", "３", "４", "５", "６", "７", "８", "９", "ａ", "ｂ", "ｃ", "ｄ", "ｅ", "ｆ", "ｇ", "ｈ", "ｉ", "ｊ", "ｋ", "ｌ", "ｍ", "ｎ", "ｏ", "ｐ", "ｑ", "ｒ", "ｓ", "ｔ", "ｕ", "ｖ", "ｗ", "ｘ", "ｙ", "ｚ", "ガ", "ギ", "グ", "ゲ", "ゴ", "ザ", "ジ", "ズ", "ゼ", "ゾ", "ダ", "ヂ", "ヅ", "デ", "ド", "バ", "ビ", "ブ", "ベ", "ボ", "パ", "ピ", "プ", "ペ", "ポ", "。", "「", "」", "、", "ヲ", "ァ", "ィ", "ゥ", "ェ", "ォ", "ャ", "ュ", "ョ", "ッ", "ー", "ア", "イ", "ウ", "エ", "オ", "カ", "キ", "ク", "ケ", "コ", "サ", "シ", "ス", "セ", "ソ", "タ", "チ", "ツ", "テ", "ト", "ナ", "ニ", "ヌ", "ネ", "ノ", "ハ", "ヒ", "フ", "ヘ", "ホ", "マ", "ミ", "ム", "メ", "モ", "ヤ", "ユ", "ヨ", "ラ", "リ", "ル", "レ", "ロ", "ワ", "ン"];
    var narrow = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z", "ｶﾞ", "ｷﾞ", "ｸﾞ", "ｹﾞ", "ｺﾞ", "ｻﾞ", "ｼﾞ", "ｽﾞ", "ｾﾞ", "ｿﾞ", "ﾀﾞ", "ﾁﾞ", "ﾂﾞ", "ﾃﾞ", "ﾄﾞ", "ﾊﾞ", "ﾋﾞ", "ﾌﾞ", "ﾍﾞ", "ﾎﾞ", "ﾊﾟ", "ﾋﾟ", "ﾌﾟ", "ﾍﾟ", "ﾎﾟ", "｡", "｢", "｣", "､", "ｦ", "ｧ", "ｨ", "ｩ", "ｪ", "ｫ", "ｬ", "ｭ", "ｮ", "ｯ", "ｰ", "ｱ", "ｲ", "ｳ", "ｴ", "ｵ", "ｶ", "ｷ", "ｸ", "ｹ", "ｺ", "ｻ", "ｼ", "ｽ", "ｾ", "ｿ", "ﾀ", "ﾁ", "ﾂ", "ﾃ", "ﾄ", "ﾅ", "ﾆ", "ﾇ", "ﾈ", "ﾉ", "ﾊ", "ﾋ", "ﾌ", "ﾍ", "ﾎ", "ﾏ", "ﾐ", "ﾑ", "ﾒ", "ﾓ", "ﾔ", "ﾕ", "ﾖ", "ﾗ", "ﾘ", "ﾙ", "ﾚ", "ﾛ", "ﾜ", "ﾝ"];
    var highlight = ["(?:０|0)", "(?:１|1)", "(?:２|2)", "(?:３|3)", "(?:４|4)", "(?:５|5)", "(?:６|6)", "(?:７|7)", "(?:８|8)", "(?:９|9)", "(?:ａ|a)", "(?:ｂ|b)", "(?:ｃ|c)", "(?:ｄ|d)", "(?:ｅ|e)", "(?:ｆ|f)", "(?:ｇ|g)", "(?:ｈ|h)", "(?:ｉ|i)", "(?:ｊ|j)", "(?:ｋ|k)", "(?:ｌ|l)", "(?:ｍ|m)", "(?:ｎ|n)", "(?:ｏ|o)", "(?:ｐ|p)", "(?:ｑ|q)", "(?:ｒ|r)", "(?:ｓ|s)", "(?:ｔ|t)", "(?:ｕ|u)", "(?:ｖ|v)", "(?:ｗ|w)", "(?:ｘ|x)", "(?:ｙ|y)", "(?:ｚ|z)", "(?:ガ|ｶﾞ)", "(?:ギ|ｷﾞ)", "(?:グ|ｸﾞ)", "(?:ゲ|ｹﾞ)", "(?:ゴ|ｺﾞ)", "(?:ザ|ｻﾞ)", "(?:ジ|ｼﾞ)", "(?:ズ|ｽﾞ)", "(?:ゼ|ｾﾞ)", "(?:ゾ|ｿﾞ)", "(?:ダ|ﾀﾞ)", "(?:ヂ|ﾁﾞ)", "(?:ヅ|ﾂﾞ)", "(?:デ|ﾃﾞ)", "(?:ド|ﾄﾞ)", "(?:バ|ﾊﾞ)", "(?:ビ|ﾋﾞ)", "(?:ブ|ﾌﾞ)", "(?:ベ|ﾍﾞ)", "(?:ボ|ﾎﾞ)", "(?:パ|ﾊﾟ)", "(?:ピ|ﾋﾟ)", "(?:プ|ﾌﾟ)", "(?:ペ|ﾍﾟ)", "(?:ポ|ﾎﾟ)", "(?:。|｡)", "(?:「|｢)", "(?:」|｣)", "(?:、|､)", "(?:ヲ|ｦ)", "(?:ァ|ｧ)", "(?:ィ|ｨ)", "(?:ゥ|ｩ)", "(?:ェ|ｪ)", "(?:ォ|ｫ)", "(?:ャ|ｬ)", "(?:ュ|ｭ)", "(?:ョ|ｮ)", "(?:ッ|ｯ)", "(?:ー|ｰ)", "(?:ア|ｱ)", "(?:イ|ｲ)", "(?:ウ|ｳ)", "(?:エ|ｴ)", "(?:オ|ｵ)", "(?:カ|ｶ)", "(?:キ|ｷ)", "(?:ク|ｸ)", "(?:ケ|ｹ)", "(?:コ|ｺ)", "(?:サ|ｻ)", "(?:シ|ｼ)", "(?:ス|ｽ)", "(?:セ|ｾ)", "(?:ソ|ｿ)", "(?:タ|ﾀ)", "(?:チ|ﾁ)", "(?:ツ|ﾂ)", "(?:テ|ﾃ)", "(?:ト|ﾄ)", "(?:ナ|ﾅ)", "(?:ニ|ﾆ)", "(?:ヌ|ﾇ)", "(?:ネ|ﾈ)", "(?:ノ|ﾉ)", "(?:ハ|ﾊ)", "(?:ヒ|ﾋ)", "(?:フ|ﾌ)", "(?:ヘ|ﾍ)", "(?:ホ|ﾎ)", "(?:マ|ﾏ)", "(?:ミ|ﾐ)", "(?:ム|ﾑ)", "(?:メ|ﾒ)", "(?:モ|ﾓ)", "(?:ヤ|ﾔ)", "(?:ユ|ﾕ)", "(?:ヨ|ﾖ)", "(?:ラ|ﾗ)", "(?:リ|ﾘ)", "(?:ル|ﾙ)", "(?:レ|ﾚ)", "(?:ロ|ﾛ)", "(?:ワ|ﾜ)", "(?:ン|ﾝ)"];

    // 全角→半角の変換マップを作成
    var wideToNarrowMap = {};
    var narrowToHighlightMap = {};

    for (var i = 0; i < wide.length; i++) {
        wideToNarrowMap[wide[i]] = narrow[i];
        // 半角文字をキーにしてハイライトパターンをマップ
        narrowToHighlightMap[narrow[i]] = highlight[i];
    }

    // 全角文字の正規表現パターンを作成（エスケープ処理を含む）
    var wideCharsPattern = wide.map(function (char) {
        return char.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    }).join('|');

    var wideToNarrowRegex = new RegExp(wideCharsPattern, 'g');

    return {
        wideToNarrowMap: wideToNarrowMap,
        narrowToHighlightMap: narrowToHighlightMap,
        wideToNarrowRegex: wideToNarrowRegex,
        // 効率的な変換関数
        convertWideToNarrow: function (text) {
            return text.replace(wideToNarrowRegex, function (match) {
                return wideToNarrowMap[match] || match;
            });
        }
    };
})();

// ========================================
// 基本ユーティリティ関数（依存なし）
// ========================================

// セレクタ用のエスケープ処理
function selectorEscape(val) {
    return val.replace(/[-\/\\^$*+?.()|[\]{}\!]/g, '\\$&');
}

// 文字列を正規化（全角→半角カナ変換、小文字化）
function normalizeForSearch(text) {
    var normalized = text.toLowerCase();
    return characterMappings.convertWideToNarrow(normalized);
}

// HTMLエンティティを復元
function decodeHtmlEntities(html) {
    return html
        .replace(htmlEntityRegexes.nbsp, "　")
        .replace(htmlEntityRegexes.gt, ">")
        .replace(htmlEntityRegexes.lt, "<")
        .replace(htmlEntityRegexes.quot, '"')
        .replace(htmlEntityRegexes.amp, "&");
}

// ========================================
// キャッシュ管理関数
// ========================================

// キャッシュを初期化
function initializeCachedElements() {
    for (var key in selectorMap) {
        if (selectorMap.hasOwnProperty(key)) {
            if (key === 'searchInput') {
                $cachedElements[key] = $(selectorMap[key], document);
            } else {
                $cachedElements[key] = $(selectorMap[key]);
            }
        }
    }
}

// キャッシュされた要素を取得（存在チェック付き）
function getCachedElement(key) {
    if (!$cachedElements[key] || $cachedElements[key].length === 0) {
        // キャッシュが無効な場合は再取得
        if (selectorMap.hasOwnProperty(key)) {
            if (key === 'searchInput') {
                $cachedElements[key] = $(selectorMap[key], document);
            } else {
                $cachedElements[key] = $(selectorMap[key]);
            }
        }
    }
    return $cachedElements[key];
}

// ========================================
// 検索処理関連関数（依存関係順）
// ========================================

// 検索語を正規化してエスケープ
function prepareSearchWords(searchValue) {
    // 全角・半角スペースを統一して連続スペースを1つにまとめる
    var searchWordTmp = searchValue.replace(/[　\s]+/g, " ").trim().toLowerCase();
    searchWordTmp = characterMappings.convertWideToNarrow(searchWordTmp);

    var searchWord = searchWordTmp.split(" ");
    for (var i = 0; i < searchWord.length; i++) {
        searchWord[i] = selectorEscape(searchWord[i].replace(/>/g, "&gt;").replace(/</g, "&lt;"));
    }
    return searchWord;
}

// ハイライト用の正規表現パターンを生成
function createHighlightPattern(searchWords) {
    // 各検索ワードを全角・半角両対応のパターンに変換
    var patterns = searchWords.map(function(word) {
        // 2文字パターンを優先的にマッチさせる正規表現を作成
        var result = '';
        var pos = 0;
        
        while (pos < word.length) {
            var matched = false;
            
            // 2文字の組み合わせを試行
            if (pos + 1 < word.length) {
                var twoChar = word.substring(pos, pos + 2);
                var pattern = characterMappings.narrowToHighlightMap[twoChar];
                if (pattern) {
                    result += pattern;
                    pos += 2;
                    matched = true;
                }
            }
            
            // 1文字で処理
            if (!matched) {
                var char = word.charAt(pos);
                var pattern = characterMappings.narrowToHighlightMap[char];
                result += pattern || char.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                pos++;
            }
        }
        
        return result;
    });
    return patterns.join("|");
}

// iframeのbody要素を取得
function getIframeBody() {
    var $iframe = getCachedElement('iframe');
    if ($iframe.length === 0) return null;
    return $iframe.contents().find("body");
}

// iframeコンテンツにハイライトを適用
function applyHighlight(searchValue) {
    var $body = getIframeBody();
    if (!$body) return;

    var searchWords = prepareSearchWords(searchValue);
    var highlightPattern = createHighlightPattern(searchWords);
    var reg = new RegExp("(" + highlightPattern + ")(?=[^<>]*<)", "gmi");
    var html = $body.html();
    var decodedHtml = decodeHtmlEntities(html);
    var highlightedHtml = decodedHtml.replace(reg, "<font class='keyword' style='color:rgb(0, 0, 0); background-color:rgb(252, 255, 0);'>$1</font>");

    $body.html(highlightedHtml);
}

// キーワードのハイライトを削除
function removeHighlight() {
    var $body = getIframeBody();
    if (!$body) return;

    $body.find(".keyword").each(function () {
        var $this = $(this);
        $this.replaceWith($this.contents());
    });
}

// 検索結果をクリア
function clearSearchResults() {
    var $searchResultItemsBlock = getCachedElement('searchResultItemsBlock');
    var $searchResultsEnd = getCachedElement('searchResultsEnd');
    var $searchMsg = getCachedElement('searchMsg');

    $searchResultItemsBlock.html("");
    $searchResultsEnd.addClass("rh-hide");
    $searchResultsEnd.attr("hidden", "");
    $searchMsg.html("2つ以上の語句を入力して検索する場合は、スペース（空白）で区切ります。");
    removeHighlight();
    currentSearchValue = "";
    disconnectMutationObserver();
}

// ========================================
// MutationObserver関連関数
// ========================================

// キーワード要素のみの追加かどうかを判定
function isOnlyKeywordAddition(mutation) {
    if (mutation.addedNodes.length !== 1) {
        return false;
    }
    
    var node = mutation.addedNodes[0];
    if (node.nodeType !== Node.ELEMENT_NODE) {
        return false;
    }
    
    // 追加されたノードがキーワード要素か、キーワード要素を含むか
    return (node.classList && node.classList.contains('keyword')) ||
           (node.querySelector && node.querySelector('.keyword') !== null);
}

// デバウンスされた再ハイライト処理
function debouncedReHighlight() {
    if (debounceTimer) {
        clearTimeout(debounceTimer);
    }

    debounceTimer = setTimeout(function () {
        reHighlightAfterDomChange();
    }, 500);
}

// DOM変更後の再ハイライト処理
function reHighlightAfterDomChange() {
    if (!currentSearchValue || currentSearchValue.trim() === "") {
        return;
    }

    try {
        disconnectMutationObserver();
        removeHighlight();
        applyHighlight(currentSearchValue);

        setTimeout(function () {
            setupMutationObserver();
        }, 100);

        console.debug("DOM変更後に検索語を再ハイライトしました");
    } catch (error) {
        console.warn("DOM変更後の再ハイライトに失敗しました:", error);
        setupMutationObserver();
    }
}

// iframeコンテンツ用のMutationObserverをセットアップ
function setupMutationObserver() {
    disconnectMutationObserver();

    try {
        var $iframe = getCachedElement('iframe');
        if ($iframe.length === 0) return;

        var iframeDocument = $iframe[0].contentDocument || $iframe[0].contentWindow.document;
        if (!iframeDocument || !iframeDocument.body) return;

        mutationObserver = new MutationObserver(function (mutations) {
            if (!currentSearchValue || currentSearchValue.trim() === "") {
                return;
            }

            var shouldReHighlight = mutations.some(function(mutation) {
                if (mutation.type === 'characterData') {
                    return true;
                }
                
                if (mutation.type === 'childList') {
                    // キーワード要素自身の追加は無視
                    if (isOnlyKeywordAddition(mutation)) {
                        return false;
                    }
                    
                    // ノードの追加または削除があれば再ハイライト
                    return mutation.addedNodes.length > 0 || mutation.removedNodes.length > 0;
                }
                
                return false;
            });

            if (shouldReHighlight) {
                debouncedReHighlight();
            }
        });

        mutationObserver.observe(iframeDocument.body, {
            childList: true,
            subtree: true,
            characterData: true,
            attributes: false
        });

        console.debug("iframeコンテンツ用のMutationObserverをセットアップしました");
    } catch (error) {
        console.warn("MutationObserverのセットアップに失敗しました:", error);
    }
}

// MutationObserverを切断
function disconnectMutationObserver() {
    if (mutationObserver) {
        mutationObserver.disconnect();
        mutationObserver = null;
    }

    if (debounceTimer) {
        clearTimeout(debounceTimer);
        debounceTimer = null;
    }
}

// ========================================
// jQueryカスタムセレクタ
// ========================================

// カスタムの:contains()セレクタ（正規化された検索用）
$.expr[':'].containsNormalized = function (elem, index, match) {
    var normalizedElemText = normalizeForSearch($(elem).text());
    var normalizedSearchText = normalizeForSearch(match[3]);
    return normalizedElemText.indexOf(normalizedSearchText) >= 0;
};

// ========================================
// jQueryイベントハンドラー
// ========================================

$(function () {
    // 要素のキャッシュを初期化
    initializeCachedElements();

    $(document).on("click", "ul.toc li.book", function () {
        if ($(this).children("a[href='#'],a[href='javascript:void 0;']").length == 0) {
            $(this).children("a").each(function () {
                location.href = location.href.replace(location.hash, "") + "#t=" + $(this).attr("href");
            });
        }
    });

    getCachedElement('searchField').each(function () {
        $(this).off();
    });

    $(document).on("keyup", ".wSearchField", function () {
        var $searchResultItemsBlock = getCachedElement('searchResultItemsBlock');
        var $searchResultsEnd = getCachedElement('searchResultsEnd');
        var $searchMsg = getCachedElement('searchMsg');
        var searchValue = $(this).val();

        // trim()を追加してスペースのみの入力も空として扱う
        if (searchValue.trim() === "") {
            clearSearchResults();
            return;
        }

        $searchMsg.html("");
        currentSearchValue = searchValue; // 現在の検索値を保存
        
        // スペースを正規化
        var searchWordTmp = searchValue.replace(/[　\s]+/g, " ").trim();
        // 正規化（全角→半角カナ、小文字化）
        searchWordTmp = normalizeForSearch(searchWordTmp);

        // 正規化後も空文字列チェックを追加
        if (searchWordTmp === "") {
            clearSearchResults();
            return;
        }

        var searchWord = searchWordTmp.split(" ");
        var searchQuery = searchWord.map(function(word) {
            return ":containsNormalized(" + word + ")";
        }).join("");

        var findItems = searchWords.find(".search_word" + searchQuery);
        if (findItems.length !== 0) {
            $searchResultsEnd.removeClass("rh-hide");
            $searchResultsEnd.removeAttr("hidden");
            $searchResultItemsBlock.html("");
            findItems.each(function () {
                var displayText = $(this).parent().find(".displayText").text();
                var parentId = $(this).parent().attr("id");
                var searchTitle = $(this).parent().find(".search_title").html();
                
                var resultHtml = "<div class='wSearchResultItem'>" +
                    "<a class='nolink' href='./" + parentId + ".html'>" +
                    "<div class='wSearchResultTitle'>" + searchTitle + "</div>" +
                    "</a>" +
                    "<div class='wSearchContent'>" +
                    "<span class='wSearchContext'>" + displayText + "</span>" +
                    "</div></div>";
                
                $searchResultItemsBlock.append($(resultHtml));
            });
            removeHighlight();
            applyHighlight(currentSearchValue);
        }
        else {
            removeHighlight();
            $searchResultsEnd.addClass("rh-hide");
            $searchResultsEnd.attr("hidden", "");
            $searchResultItemsBlock.html("");
            var displayText = "検索条件に一致するトピックはありません。";
            $searchResultItemsBlock.append($("<div class='wSearchResultItem'><div class='wSearchContent'><span class='wSearchContext'>" + displayText + "</span></div></div>"));
        }
    });

    getCachedElement('iframe').on("load", function () {
        var $searchInput = getCachedElement('searchInput');
        var $searchField = getCachedElement('searchField');

        if ($searchInput.is(":not(.rh-hide)") && ($searchField.val() != "")) {
            var searchValue = $searchField.val();
            currentSearchValue = searchValue; // 現在の検索値を保存
            applyHighlight(searchValue);
        }

        // iframeコンテンツ変更用のMutationObserverをセットアップ
        setupMutationObserver();
    });
});
